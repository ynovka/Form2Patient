<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru"
      th:replace="~{patient/template :: layout(title=#{patient.dashboard.page.title}, content=~{::content})}">
<div th:fragment="content" class="w-full max-w-6xl mx-auto py-4 sm:py-6 lg:py-8 flex-1">
    <div class="bg-white border border-gray-300 mb-4 sm:mb-6 rounded-none overflow-hidden">
        <div class="bg-blue-600 text-white px-3 sm:px-5 py-2 sm:py-3">
            <h1 class="text-base sm:text-xl lg:text-2xl font-bold" th:text="#{patient.dashboard.title}">Доступные формы для заполнения</h1>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(blank_forms)}" class="bg-white border border-gray-300 overflow-hidden rounded-none">
        <div class="p-4 sm:p-6 text-center">
            <div class="mb-4 sm:mb-6">
                <div class="w-16 h-16 sm:w-20 sm:h-20 mx-auto bg-gray-100 border border-gray-300 flex items-center justify-center mb-4 sm:mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 sm:w-10 sm:h-10 fill-gray-400" viewBox="0 -960 960 960">
                        <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v268q-19-9-39-15.5t-41-9.5v-243H200v560h242q3 22 9.5 42t15.5 38H200Zm0-120v40-560 243-3 280Zm80-40h163q3-21 9.5-41t14.5-39H280v80Zm0-160h244q32-30 71.5-50t84.5-27v-3H280v80Zm0-160h400v-80H280v80Zm200-190q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790ZM720-40q-83 0-141.5-58.5T520-240q0-83 58.5-141.5T720-440q83 0 141.5 58.5T920-240q0 83-58.5 141.5T720-40Zm-20-80h40v-100h100v-40H740v-100h-40v100H600v40h100v100Z"/>
                    </svg>
                </div>
                <h2 class="text-lg sm:text-xl font-bold text-gray-700 mb-2 sm:mb-4" th:text="#{patient.dashboard.empty.title}">Нет доступных форм</h2>
                <p class="text-sm sm:text-base text-gray-500" th:text="#{patient.dashboard.empty.description}">В настоящее время нет форм для заполнения</p>
            </div>
        </div>
    </div>

    <div th:if="${!#lists.isEmpty(blank_forms)}" class="space-y-3 sm:space-y-4 lg:space-y-6">
        <div th:each="form : ${blank_forms}"
             class="bg-white border border-gray-300 cursor-pointer hover:border-blue-400 hover:shadow-md active:scale-[0.98] transition-all duration-200 group overflow-hidden touch-manipulation"
             th:attr="data-href='/patient/form/blank/' + ${form.filename}">

            <div class="p-4 sm:p-5">
                <div class="flex flex-wrap sm:flex-nowrap items-start sm:items-center justify-between gap-3">
                    <div class="flex items-start sm:items-center flex-1 min-w-0 gap-3">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0 bg-blue-100 border border-blue-300 flex items-center justify-center group-hover:bg-blue-200 transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6 fill-blue-600" viewBox="0 -960 960 960">
                                <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm80-40h400v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm200-190q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790Z"/>
                            </svg>
                        </div>
                        <div class="min-w-0">
                            <h3 class="text-sm sm:text-base lg:text-lg font-bold text-gray-800 group-hover:text-blue-600 truncate transition-colors duration-200" th:text="${form.title}">[[#{patient.dashboard.form.title.placeholder}]]</h3>
                            <p class="text-xs sm:text-sm text-gray-600 mt-1 truncate" th:text="#{patient.dashboard.form.description}">Анкета для заполнения</p>
                        </div>
                    </div>

                    <div class="w-8 h-8 sm:w-10 sm:h-10 flex-shrink-0 bg-gray-100 border border-gray-300 flex items-center justify-center group-hover:bg-blue-100 group-hover:border-blue-300 transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5 fill-gray-600 group-hover:fill-blue-600 transition-transform duration-200" viewBox="0 -960 960 960">
                            <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="h-1 bg-gray-100 group-hover:bg-blue-200 transition-colors duration-200"></div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

            document.querySelectorAll('[data-href]').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.preventDefault();

                    const arrow = el.querySelector('svg:last-child');
                    if (arrow) {
                        arrow.style.transform = 'rotate(90deg)';
                    }

                    if (navigator.vibrate && isTouchDevice) {
                        navigator.vibrate(50);
                    }

                    setTimeout(() => {
                        window.location.href = el.dataset.href;
                    }, 150);
                });

                if (!isTouchDevice) {
                    el.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                    });

                    el.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                    });
                }

                if (isTouchDevice) {
                    el.addEventListener('touchstart', function() {
                        this.style.transform = 'translateY(-1px) scale(0.99)';
                    }, { passive: true });

                    el.addEventListener('touchend', function() {
                        setTimeout(() => {
                            this.style.transform = 'translateY(0) scale(1)';
                        }, 100);
                    }, { passive: true });

                    el.addEventListener('touchcancel', function() {
                        this.style.transform = 'translateY(0) scale(1)';
                    }, { passive: true });
                }
            });
        });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</div>
</html>